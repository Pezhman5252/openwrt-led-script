# اسکریپت کنترل هوشمند LED وضعیت اینترنت برای OpenWrt

این پروژه شامل یک اسکریپت هوشمند برای روترهای مجهز به سیستم‌عامل OpenWrt است که رنگ LED دستگاه را بر اساس وضعیت واقعی و کامل اتصال به اینترنت تغییر می‌دهد. این اسکریپت فراتر از یک `ping` ساده عمل کرده و اطمینان حاصل می‌کند که اینترنت به معنای واقعی کلمه در دسترس است.

<div dir="rtl">

## ✨ ویژگی‌های کلیدی

- **بررسی چند لایه و هوشمند:** وضعیت اینترنت به صورت آبشاری در سه لایه بررسی می‌شود:
  1.  **Ping:** بررسی اتصال اولیه به سرورهای جهانی (مانند 8.8.8.8).
  2.  **DNS:** بررسی صحت عملکرد DNS برای ترجمه نام دامنه.
  3.  **Captive Portal:** اطمینان از عدم وجود صفحه لاگین (مانند صفحات هتل‌ها یا فرودگاه‌ها) و دسترسی کامل به محتوای وب.

- **بهینه‌سازی شده برای روتر:** اسکریپت با حداقل استفاده از منابع پردازشی (CPU) و جلوگیری از نوشتن‌های غیرضروری روی حافظه فلش (Flash Memory) طراحی شده است تا عملکرد و طول عمر دستگاه را تحت تأثیر قرار ندهد.

- **پایداری حداکثری:** با بهره‌گیری از سیستم مدیریت سرویس استاندارد OpenWrt یعنی `procd`، در صورت بروز هرگونه خطا یا بسته‌شدن غیرمنتظره، اسکریپت به صورت خودکار و هوشمند مجدداً راه‌اندازی می‌شود.

- **پیکربندی آسان:** تمام تنظیمات مهم مانند آدرس‌های هدف، نام LED ها و شدت روشنایی در ابتدای فایل اسکریپت اصلی قرار گرفته‌اند و به راحتی قابل شخصی‌سازی هستند.

- **گزارش‌دهی (Logging):** تمام رویدادهای مهم (اتصال، قطعی و خطاها) در لاگ سیستم OpenWrt ثبت می‌شوند که عیب‌یابی را بسیار آسان می‌کند.

---

## 🚀 نصب سریع (دستور یک خطی)

برای نصب، کافیست از طریق SSH به ترمینال روتر خود متصل شوید و دستور زیر را به صورت کامل کپی و اجرا کنید. این دستور به صورت خودکار تمام مراحل را انجام می‌دهد.

```sh
wget https://raw.githubusercontent.com/Pezhman5252/openwrt-led-script/main/install.sh -O /tmp/install.sh && sh /tmp/install.sh
```

اسکریپت نصب به صورت خودکار فایل‌ها را دانلود، در مسیرهای صحیح قرار داده، مجوزهای لازم را تنظیم و سرویس را برای اولین بار فعال و اجرا می‌کند.

---

## 🔧 پیکربندی پس از نصب (بسیار مهم)

مهم‌ترین بخش پس از نصب، تنظیم شناسه‌های LED مخصوص روتر شماست. هر مدل روتر ممکن است نام‌های متفاوتی برای LED های خود داشته باشد.

۱. ابتدا با دستور زیر، لیست LED های موجود در روتر خود را مشاهده کنید:
```sh
ls /sys/class/leds/
```
خروجی این دستور، نام‌هایی مانند `green:wan`, `red:power` یا `your_router_model:blue:usb` خواهد بود. نام‌های مربوط به LED چندرنگ اصلی دستگاه خود را پیدا کنید.

۲. فایل اسکریپت اصلی را با یک ویرایشگر متن مانند `vi` یا `nano` باز کنید:
```sh
vi /usr/bin/internet_led_status.sh
```
*(نکته: در ویرایشگر `vi`، کلید `i` را برای ورود به حالت ویرایش و کلید `Esc` و سپس تایپ `:wq` و فشردن `Enter` را برای ذخیره و خروج استفاده کنید.)*

۳. در بخش تنظیمات، مقادیر متغیرهای `LED_GREEN`، `LED_RED` و `LED_BLUE` را با نام‌های دقیقی که در مرحله اول پیدا کردید، جایگزین کنید.

۴. پس از ذخیره تغییرات، سرویس را با دستور زیر مجدداً راه‌اندازی کنید تا تنظیمات جدید اعمال شوند:
```sh
/etc/init.d/internet_led restart
```

---

## ⚙️ دستورات مدیریتی سرویس

شما می‌توانید سرویس را به راحتی از طریق ترمینال مدیریت کنید:

- **شروع سرویس:**
  ```sh
  /etc/init.d/internet_led start
  ```
- **توقف سرویس:**
  ```sh
  /etc/init.d/internet_led stop
  ```
- **راه‌اندازی مجدد (برای اعمال تغییرات):**
  ```sh
  /etc/init.d/internet_led restart
  ```
- **فعال‌سازی سرویس برای اجرا در زمان بوت:**
  ```sh
  /etc/init.d/internet_led enable
  ```
- **غیرفعال‌سازی سرویس در زمان بوت:**
  ```sh
  /etc/init.d/internet_led disable
  ```
- **مشاهده وضعیت لحظه‌ای سرویس:**
  ```sh
  logread -f -e "InternetLED"
  ```

---

## 🗑️ حذف کامل

برای حذف کامل اسکریپت و سرویس از روی روتر، دستورات زیر را به ترتیب در ترمینال اجرا کنید:

```sh
# ابتدا سرویس را متوقف و غیرفعال کنید
/etc/init.d/internet_led stop
/etc/init.d/internet_led disable

# سپس فایل‌های مربوطه را حذف کنید
rm /etc/init.d/internet_led
rm /usr/bin/internet_led_status.sh

echo "اسکریپت کنترلر LED با موفقیت حذف شد."
```

</div>
