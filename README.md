# اسکریپت کنترل هوشمند LED وضعیت اینترنت برای OpenWrt

این پروژه شامل یک اسکریپت هوشمند و بهینه برای روترهای مجهز به سیستم‌عامل OpenWrt است که رنگ LED دستگاه را بر اساس وضعیت **واقعی و کامل** اتصال به اینترنت تغییر می‌دهد. این اسکریپت فراتر از یک `ping` ساده عمل کرده و با بررسی چند لایه، اطمینان حاصل می‌کند که اینترنت بدون هیچ مانعی در دسترس است.

<div dir="rtl">

## ✨ ویژگی‌های کلیدی

- **نصب کاملاً خودکار:** اسکریپت نصب به صورت هوشمند پیش‌نیازهای خود (`wget-ssl` و `ca-bundle`) را بررسی و در صورت نیاز نصب می‌کند. کاربر فقط یک دستور را اجرا می‌کند.
- **بررسی چند لایه و هوشمند:** وضعیت اینترنت به صورت آبشاری در سه لایه بررسی می‌شود تا از تشخیص اشتباه جلوگیری شود:
  1.  **Ping:** بررسی اتصال پایه به سرورهای پایدار جهانی (مانند 8.8.8.8 و 1.1.1.1).
  2.  **DNS:** حصول اطمینان از عملکرد صحیح DNS برای ترجمه نام دامنه‌ها.
  3.  **Captive Portal:** تشخیص صفحات لاگین (مربوط به هتل‌ها، فرودگاه‌ها و ...) و اطمینان از دسترسی مستقیم به اینترنت.
- **بهینه‌سازی شده برای روتر:** با حداقل استفاده از منابع پردازشی (CPU) و جلوگیری از نوشتن‌های غیرضروری روی حافظه فلش (Flash Memory) طراحی شده تا عملکرد و طول عمر دستگاه را تضمین کند.
- **پایداری حداکثری:** با بهره‌گیری از سیستم مدیریت سرویس استاندارد OpenWrt یعنی `procd`، در صورت بروز هرگونه خطا، سرویس به صورت خودکار مجدداً راه‌اندازی می‌شود.
- **پیکربندی آسان:** تمام تنظیمات اصلی مانند آدرس‌های هدف، نام LED ها و شدت روشنایی در ابتدای فایل اسکریپت اصلی به صورت خوانا قرار گرفته‌اند.
- **گزارش‌دهی دقیق:** تمام رویدادهای مهم (اتصال، قطعی و دلایل آن) در لاگ سیستم OpenWrt ثبت می‌شوند که عیب‌یابی را بسیار آسان می‌کند.

---

## 🚀 نصب سریع و خودکار (دستور یک خطی)

برای نصب، کافیست از طریق SSH به ترمینال روتر خود متصل شوید و دستور زیر را به صورت کامل کپی و اجرا کنید. این دستور به صورت خودکار تمام مراحل، از جمله نصب پیش‌نیازها تا فعال‌سازی سرویس را انجام می‌دهد.

```sh
wget --no-check-certificate https://raw.githubusercontent.com/Pezhman5252/openwrt-led-script/main/install.sh -O /tmp/install.sh && sh /tmp/install.sh
```

**این دستور چه کاری انجام می‌دهد؟**
این دستور ابتدا اسکریپت نصب را (با نادیده گرفتن موقت گواهی SSL برای سازگاری با سیستم‌های خام) دانلود می‌کند. سپس، اسکریپت نصب اجرا شده و در اولین قدم، پکیج‌های لازم برای اتصال امن اینترنتی را نصب می‌کند و پس از آن، فایل‌های اصلی پروژه را به صورت امن دانلود و سرویس را راه‌اندازی می‌کند.

---

## 🔧 پیکربندی پس از نصب (بسیار مهم)

مهم‌ترین قدم پس از نصب، تنظیم شناسه‌های LED مخصوص مدل روتر شماست، زیرا این نام‌ها در دستگاه‌های مختلف متفاوت است.

**۱. پیدا کردن نام LED ها:**
ابتدا با دستور زیر، لیست LED های موجود در روتر خود را مشاهده کنید:
```sh
ls /sys/class/leds/
```
خروجی این دستور، نام‌هایی مانند `gl-ar300m:green:wan`، `tp-link:blue:qss` یا `your_router_model:green:internet` خواهد بود. نام‌های مربوط به LED چندرنگ اصلی دستگاه خود را که می‌خواهید کنترل کنید، پیدا کنید.

**۲. ویرایش فایل پیکربندی:**
فایل اسکریپت اصلی را با یک ویرایشگر متن مانند `vi` یا `nano` باز کنید:
```sh
vi /usr/bin/internet_led_status.sh
```
*(نکته: در ویرایشگر `vi`، کلید `i` را برای ورود به حالت ویرایش فشار دهید. پس از انجام تغییرات، کلید `Esc` را زده، سپس `:wq` را تایپ و `Enter` را فشار دهید تا فایل ذخیره و بسته شود.)*

**۳. اعمال تغییرات:**
در بخش تنظیمات (`--- بخش تنظیمات قابل تغییر ---`)، مقادیر متغیرهای `LED_GREEN`، `LED_RED` و `LED_BLUE` را با نام‌های دقیقی که در مرحله اول پیدا کردید، جایگزین نمایید.

**۴. راه‌اندازی مجدد سرویس:**
پس از ذخیره تغییرات، سرویس را با دستور زیر مجدداً راه‌اندازی کنید تا تنظیمات جدید اعمال شوند:
```sh
/etc/init.d/internet_led restart```

---

## ⚙️ دستورات مدیریتی سرویس

شما می‌توانید سرویس را به راحتی از طریق ترمینال مدیریت کنید:

| عملکرد                  | دستور                                  |
| ----------------------- | -------------------------------------- |
| **شروع سرویس**          | `/etc/init.d/internet_led start`       |
| **توقف سرویس**           | `/etc/init.d/internet_led stop`        |
| **راه‌اندازی مجدد**      | `/etc/init.d/internet_led restart`     |
| **فعال‌سازی در بوت**      | `/etc/init.d/internet_led enable`      |
| **غیرفعال‌سازی در بوت**   | `/etc/init.d/internet_led disable`     |
| **مشاهده لاگ‌ها**         | `logread -f -e "InternetLED"`          |

---

## 🗑️ حذف کامل

برای حذف کامل اسکریپت و سرویس از روی روتر، دستورات زیر را به ترتیب در ترمینال اجرا کنید. این کار تمام فایل‌های مربوطه را پاک کرده و سرویس را غیرفعال می‌کند.

```sh
# ۱. ابتدا سرویس را متوقف و غیرفعال کنید
/etc/init.d/internet_led stop
/etc/init.d/internet_led disable

# ۲. سپس فایل‌های مربوطه را حذف کنید
rm /etc/init.d/internet_led
rm /usr/bin/internet_led_status.sh

echo "اسکریپت کنترلر LED با موفقیت حذف شد."
```

</div>
